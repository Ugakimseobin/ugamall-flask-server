{% extends "base.html" %}
{% block content %}
<div class="max-w-md mx-auto p-6 sm:p-8 bg-white shadow-lg rounded mt-10">
  <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-center text-gray-600">
    {{ _("ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •") }}
  </h2>

  <form method="post" id="reset-form" class="space-y-4 text-sm sm:text-base">
    <!-- ìƒˆ ë¹„ë°€ë²ˆí˜¸ -->
    <div>
      <label class="block font-semibold mb-1">{{ _("ìƒˆ ë¹„ë°€ë²ˆí˜¸") }}</label>
      <input type="password" id="new_password" name="new_password" minlength="8"
             placeholder="ì˜ë¬¸+ìˆ«ì+íŠ¹ìˆ˜ë¬¸ì í¬í•¨ 8ìë¦¬ ì´ìƒ"
             required
             class="w-full border p-2 rounded focus:ring-2 focus:ring-indigo-400"
             oninput="checkPasswordStrength(this.value); checkPasswordMatch();">
      <div class="w-full bg-gray-200 rounded-full h-2 mt-3">
        <div id="pw-strength" class="h-2 rounded-full transition-all duration-300"></div>
      </div>
      <p id="pw-strength-text" class="text-sm text-gray-600 mt-2"></p>
      <p class="text-xs text-gray-500 mt-1">ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ë©° ìˆ«ìì™€ íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.</p>
    </div>

    <!-- ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ -->
    <div>
      <label class="block font-semibold mb-1">{{ _("ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸") }}</label>
      <input type="password" id="new_password_confirm" name="new_password_confirm" minlength="8"
             placeholder="{{ _('ë¹„ë°€ë²ˆí˜¸ ë‹¤ì‹œ ì…ë ¥') }}"
             required
             class="w-full border p-2 rounded focus:ring-2 focus:ring-indigo-400"
             oninput="checkPasswordMatch();">
      <p id="pw-match-text" class="text-sm mt-2"></p>
    </div>

    <!-- ë²„íŠ¼ -->
    <button type="submit"
            class="w-full bg-indigo-600 text-white py-2 rounded-lg font-semibold hover:bg-indigo-700 transition">
      {{ _("ë¹„ë°€ë²ˆí˜¸ ë³€ê²½") }}
    </button>
  </form>

  <!-- ì•ˆë‚´ ë¬¸êµ¬ -->
  <p class="mt-6 text-xs text-gray-500 text-center">
    ğŸ”’ {{ _("ë¹„ë°€ë²ˆí˜¸ëŠ” ì•ˆì „í•˜ê²Œ ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.") }}<br>
    {{ _("ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì—ì„œ ì‚¬ìš©í•˜ì§€ ì•Šì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.") }}
  </p>
</div>

<script>
function checkPasswordStrength(password) {
  const bar = document.getElementById("pw-strength");
  const text = document.getElementById("pw-strength-text");

  const hasLength = password.length >= 8;
  const hasNumber = /[0-9]/.test(password);
  const hasSymbol = /[^A-Za-z0-9]/.test(password);

  let score = [hasLength, hasNumber, hasSymbol].filter(Boolean).length;
  const colors = ["#f87171", "#facc15", "#34d399"];
  const labels = ["ì•½í•¨", "ë³´í†µ", "ê°•í•¨"];

  bar.style.width = ["25%", "50%", "100%"][Math.min(score - 1, 2)] || "0%";
  bar.style.background = colors[Math.min(score - 1, 2)] || "#d1d5db";
  text.textContent = score < 3 ? `ë¹„ë°€ë²ˆí˜¸ ê°•ë„: ${labels[Math.min(score - 1, 2)] || 'ì•½í•¨'}` : "ë¹„ë°€ë²ˆí˜¸ ê°•ë„: ë§¤ìš° ê°•í•¨";
  text.className = `text-sm mt-1 ${score < 2 ? 'text-red-500' : score === 2 ? 'text-yellow-600' : 'text-green-600'}`;
}

function checkPasswordMatch() {
  const pw = document.getElementById("new_password").value;
  const pwc = document.getElementById("new_password_confirm").value;
  const text = document.getElementById("pw-match-text");

  if (!pwc) {
    text.textContent = "";
    return;
  }

  if (pw === pwc) {
    text.textContent = "âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.";
    text.className = "text-sm text-green-600 mt-2";
  } else {
    text.textContent = "âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
    text.className = "text-sm text-red-500 mt-2";
  }
}

// ì œì¶œ ì‹œ ìœ íš¨ì„± ê²€ì‚¬
document.getElementById("reset-form").addEventListener("submit", e => {
  const pw = document.getElementById("new_password").value;
  const pwc = document.getElementById("new_password_confirm").value;
  const regex = /^(?=.*[0-9])(?=.*[^A-Za-z0-9]).{8,}$/;

  if (!regex.test(pw)) {
    e.preventDefault();
    alert("ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ë©° ìˆ«ìì™€ íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.");
    return false;
  }
  if (pw !== pwc) {
    e.preventDefault();
    alert("ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    return false;
  }
});
</script>

<style>
input:focus { outline: none !important; box-shadow: 0 0 0 2px rgba(99,102,241,0.3); }
button { transition: all 0.2s ease; }
</style>
{% endblock %}
