{% extends "base.html" %}
{% block content %}
<div class="max-w-xl mx-auto p-6 sm:p-8 bg-white shadow-2xl rounded-2xl mt-14 border border-gray-100">
  <!-- 헤더 -->
  <div class="text-center mb-8">
    <h2 class="text-3xl font-extrabold text-indigo-700 mb-2">{{ _("이용약관 동의") }}</h2>
    <p class="text-gray-500 text-sm sm:text-base">
      {{ _("회원가입을 위해 아래 약관에 동의해주세요.") }}
    </p>
  </div>

  <!-- 약관 폼 -->
  <form method="post" class="space-y-5 text-sm sm:text-base">
    <!-- 전체 동의 -->
    <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-100 flex items-center justify-between hover:bg-indigo-100 transition">
      <label class="flex items-center font-semibold text-indigo-800 text-lg cursor-pointer">
        <input type="checkbox" id="agree_all"
               class="w-5 h-5 mr-2 accent-indigo-600 cursor-pointer">
        {{ _("모두 동의합니다") }}
      </label>
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5-2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    </div>

    <hr class="my-4">

    <!-- ✅ 약관 항목들 -->
    <div class="space-y-3">
      {% set terms_list = [
        {{ _("('agree_terms', '유가몰 구매회원 이용약관 (필수)', 'terms1', True)") }},
        {{ _("('agree_finance', '전자금융서비스 이용약관 동의 (필수)', 'terms2', True)") }},
        ('agree_privacy', '개인정보 수집 및 이용동의 (필수)', 'terms3', True),
        ('agree_age', '만 14세 이상입니다. (필수)', 'terms4', True),
        ('agree_marketing', '혜택 알림 이메일, 문자, 앱 푸시 수신 (선택)', 'terms5', False)
      ] %}
      
      {% for name, label, key, required in terms_list %}
      <div class="flex justify-between items-center bg-gray-50 border border-gray-200 rounded-lg p-3 hover:shadow-sm transition">
        <label class="flex-1 flex items-center cursor-pointer">
          <input type="checkbox" name="{{ name }}" class="agree-item w-4 h-4 accent-indigo-600 mr-3 cursor-pointer" {% if required %}required{% endif %}>
          <span class="{% if required %}text-gray-800{% else %}text-gray-600{% endif %}">
            {{ _(label) }}
          </span>
        </label>
        <button type="button" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium underline"
                onclick="openModal('{{ key }}')">
          {{ _("보기") }}
        </button>
      </div>
      {% endfor %}
    </div>

    <!-- 다음 단계 버튼 -->
    <div class="mt-8">
      <button type="submit"
              class="w-full py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 active:scale-[0.98] transition-all shadow-md">
        {{ _("다음 단계로 이동") }}
      </button>
    </div>
  </form>
</div>

<!-- 🌙 약관 모달 -->
<div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 transition-all">
  <div class="bg-white rounded-xl shadow-2xl max-w-lg w-11/12 sm:w-full p-6 relative animate-fadeIn">
    <h3 id="modal-title" class="text-xl font-bold mb-4 text-indigo-700 flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V4a2 2 0 10-4 0v1.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0a3 3 0 01-6 0" />
      </svg>
      {{ _("약관 상세보기") }}
    </h3>
    <div id="modal-content" class="h-64 overflow-y-auto border rounded p-4 text-sm leading-relaxed bg-gray-50 text-gray-700 shadow-inner"></div>
    <button onclick="closeModal()" class="absolute top-3 right-4 text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
    <div class="text-right mt-5">
      <button onclick="closeModal()" class="px-6 py-2 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 shadow">
        {{ _("닫기") }}
      </button>
    </div>
  </div>
</div>

<!-- ✅ JS -->
<script>
  const agreeAll = document.getElementById("agree_all");
  const items = document.querySelectorAll(".agree-item");

  // 전체 동의 → 개별 체크 반영
  agreeAll.addEventListener("change", function() {
    items.forEach(chk => chk.checked = this.checked);
  });

  // 개별 체크 → 전체 동의 상태 반영
  items.forEach(chk => {
    chk.addEventListener("change", () => {
      agreeAll.checked = [...items].every(i => i.checked);
    });
  });

  // 약관 내용 (샘플)
  const termsData = {
    terms1: "유가몰 구매회원 이용약관 전문 내용입니다. 상품 구매, 결제, 교환, 환불 등 전반적인 이용조건이 포함됩니다...",
    terms2: "전자금융서비스 이용약관 내용입니다. 결제 대행, 전자지급, 안전한 거래 보장에 관한 안내...",
    terms3: "개인정보 수집 및 이용 동의 전문입니다. 수집항목, 보유기간, 제3자 제공 관련 조항 포함...",
    terms4: "만 14세 이상임을 확인합니다. 법적으로 미성년자 보호를 위한 필수 동의사항입니다.",
    terms5: "마케팅/혜택 수신 동의 내용입니다. 이메일, 문자, 앱 푸시를 통한 이벤트 및 쿠폰 소식 제공에 관한 안내..."
  };

  // 모달 열기
  function openModal(key) {
    const modal = document.getElementById("modal");
    document.getElementById("modal-content").innerText = termsData[key] || "내용이 없습니다.";
    modal.classList.remove("hidden");
  }

  // 모달 닫기
  function closeModal() {
    document.getElementById("modal").classList.add("hidden");
  }
</script>

<!-- ✅ 간단한 fadeIn 효과 -->
<style>
@keyframes fadeIn { from { opacity: 0; transform: scale(0.97); } to { opacity: 1; transform: scale(1); } }
.animate-fadeIn { animation: fadeIn 0.25s ease-in-out; }
</style>

{% endblock %}
