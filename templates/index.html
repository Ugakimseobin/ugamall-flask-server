{% extends "base.html" %}
{% block content %}
<!-- Shorts Section -->
<section class="relative w-full h-[500px] md:h-[800px] bg-[#f2f2f2] overflow-hidden">
  {% if latest_video %}
    <div class="relative w-full h-full">
      <!-- ì˜ìƒ -->
      <video class="w-full h-full object-cover" autoplay muted loop playsinline>
        <source src="{{ url_for('serve_video', video_id=latest_video.id) }}" type="{{ latest_video.video_mime or 'video/mp4' }}">
      </video>

      <!-- âœ… ë°ìŠ¤í¬íƒ‘ ì „ìš© ì˜¤ë²„ë ˆì´ -->
      <div class="hidden sm:flex absolute top-0 left-0 h-full w-2/3 md:w-1/2
                  bg-gradient-to-r from-black/80 to-transparent
                  transform -translate-x-2/3 hover:translate-x-0
                  transition-transform duration-700 ease-in-out
                  items-center p-4 sm:p-6 text-white cursor-pointer">

        <div class="text-sm sm:text-base md:text-lg">
          <h2 class="text-lg sm:text-xl md:text-2xl font-bold text-white drop-shadow-[0_0_4px_rgba(0,0,0,0.8)] mb-2 sm:mb-3">{{ _(latest_video.title or " ") }}</h2>
          <p class="mb-3 sm:mb-4 text-gray-200 text-xs text-[#ddd] sm:text-sm md:text-base">{{ _(latest_video.description or " ") }}</p>
          <a href="/videos" 
             class="inline-block btn-dark px-5 py-2.5 rounded-full shadow hover:opacity-90 transition text-sm sm:text-base font-medium">
            {{ _("ì˜ìƒ ë” ë³´ê¸° â†’") }}
          </a>
        </div>

        <!-- ì„¸ë¡œ í…ìŠ¤íŠ¸ ì•ˆë‚´ -->
        <div class="absolute top-1/2 right-2 sm:right-3 -translate-y-1/2
            [writing-mode:vertical-rl] rotate--180
            font-bold text-xs sm:text-sm md:text-lg tracking-wider
            text-white drop-shadow-[0_0_4px_rgba(0,0,0,0.8)]
            flex items-center gap-1 pointer-events-none">
            <span class="animate-bounce">â–¼</span>
            <span>{{ _("ìì„¸íˆ ë³´ê¸°") }}</span>
        </div>
      </div>

      <!-- âœ… ëª¨ë°”ì¼ ì „ìš© ì„¤ëª… ë°•ìŠ¤ -->
      <div class="sm:hidden absolute bottom-0 left-0 w-full">
        <!-- ğŸ‘‡ íë¦¼ ê·¸ë¼ë°ì´ì…˜: í…ìŠ¤íŠ¸ë°•ìŠ¤ ë°”ë¡œ ìœ„ ê²½ê³„ ë¶€ë¶„ë§Œ -->
        <div class="absolute -top-10 left-0 w-full h-10 bg-gradient-to-b from-transparent via-black/30 to-black/60 pointer-events-none"></div>

        <!-- í…ìŠ¤íŠ¸ ë°•ìŠ¤ -->
        <div class="relative bg-black/60 text-white px-4 pb-3 backdrop-blur-[2px]">
          <h2 class="text-base font-semibold mb-1">{{ _(latest_video.title or " ") }}</h2>
          <p class="text-xs text-gray-200 mb-2">{{ _(latest_video.description or " ") }}</p>
          <a href="/videos"
             class="inline-block bg-white text-black text-xs font-medium px-3 py-1.5 rounded-full shadow hover:bg-gray-200 transition">
            {{ _("ì˜ìƒ ë” ë³´ê¸° â†’") }}
          </a>
        </div>
      </div>
    </div>
  {% else %}
    <div class="flex items-center justify-center h-full text-black">
      <p>{{ _("ì•„ì§ ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.") }}</p>
    </div>
  {% endif %}
</section>

<section class="bg-gray-50 max-w-full mx-auto px-4 sm:px-10 md:px-16 py-14 md:py-20 grid grid-cols-1 md:grid-cols-2 gap-10 items-center">
  {% if ads and ads|length > 0 %}
    <!-- ì™¼ìª½ í…ìŠ¤íŠ¸ -->
    <div>
      <h2 class="text-3xl sm:text-4xl font-extrabold text-[#222] mb-4 sm:mb-4">
        {{ _(ads[0].title or " ") }}
      </h2>
      <p class="text-gray-600 mb-6 text-sm sm:text-base leading-relaxed">
        <strong class="text-lg">{{ _(ads[0].subtitle or " ") }}</strong><br>
        {{ _(ads[0].description or " ") }}
      </p>
      <a href="{{ ads[0].link_url or '/products' }}" target="_blank"
         class="inline-block btn-dark px-6 py-2 text-white rounded-full shadow hover:opacity-90 text-sm sm:text-base transition">
        {{ _("ìì„¸íˆ ë³´ëŸ¬ê°€ê¸° â†’") }}
      </a>
    </div>

    <!-- ì˜¤ë¥¸ìª½ ì´ë¯¸ì§€ ìºëŸ¬ì…€ (ë°ìŠ¤í¬íƒ‘) -->
    <div class="hidden sm:flex relative w-full h-72 md:h-80 items-center justify-center overflow-hidden">
      <div id="ad-carousel-pc" class="relative w-full h-full flex items-center justify-center">
        {% for ad in ads %}
          {% for img in ad.images %}
            <img src="{{ url_for('ad_image', image_id=img.id) }}"
                alt="{{ ad.title }}"
                class="ad-slide w-[300px] md:w-[350px] absolute rounded-lg shadow">
          {% endfor %}
        {% endfor %}
      </div>
    </div>

    <!-- ëª¨ë°”ì¼ ì „ìš© (ìŠ¤ì™€ì´í”„) -->
    <div class="sm:hidden relative w-full h-80 overflow-x-auto">
      <div class="flex space-x-4 w-max px-4 snap-x snap-mandatory">
        {% for ad in ads %}
          {% for img in ad.images %}
            <img src="{{ url_for('ad_image', image_id=img.id) }}"
                alt="{{ ad.title }}"
                class="w-64 h-72 object-cover rounded-lg shadow snap-center flex-shrink-0">
          {% endfor %}
        {% endfor %}
      </div>
    </div>
  {% else %}
    <!-- ê´‘ê³  ì—†ì„ ë•Œ -->
    <div class="col-span-2 text-center text-gray-500 py-10">
      {{ _("ë“±ë¡ëœ ê´‘ê³ ê°€ ì—†ìŠµë‹ˆë‹¤.") }}
    </div>
  {% endif %}
</section>

<!-- Company Section -->
<section class="py-12 sm:py-16 text-center bg-white">
  <h2 class="text-3xl sm:text-4xl font-bold mb-5 text-[#222] sm:mb-6" style="font-family:'DesignHouse',sans-serif; font-weight:700; font-size:2rem;">{{ _("ìœ ê°€ëª° ì†Œê°œ") }}</h2>
  <p class="max-w-2xl mx-auto text-gray-600 text-sm sm:text-base leading-relaxed whitespace-pre-line">
    {{ _("ìœ ê°€ëª°ì€ ëˆ„êµ¬ë‚˜ í¸ë¦¬í•˜ê²Œ ì´ìš©í•  ìˆ˜ ìˆëŠ” ì˜ë£Œìš©í’ˆ ì „ë¬¸ ìŠ¤í† ì–´ì…ë‹ˆë‹¤.
ì¼ìƒì—ì„œ í•„ìš”í•œ ì œí’ˆì„ ê°„í¸í•˜ê²Œ ë§Œë‚˜ë³´ì„¸ìš”.
ë¯¿ì„ ìˆ˜ ìˆëŠ” í’ˆì§ˆ, í•©ë¦¬ì ì¸ ê°€ê²©, ë¹ ë¥¸ ë°°ì†¡ìœ¼ë¡œ ì—¬ëŸ¬ë¶„ì˜ ê±´ê°•í•œ ìƒí™œì„ ì‘ì›í•©ë‹ˆë‹¤ ") }}
  </p>
</section>

<!-- Contact Section -->
<section class="bg-[#f7f7f7] py-20 sm:py-16">
  <div class="max-w-3xl mx-auto px-4">
    <h2 class="text-3xl sm:text-4xl font-bold mb-8 text-center text-[#222]">{{ _("ë¬¸ì˜í•˜ê¸°") }}</h2>
    <form method="POST" action="{{ url_for('contact') }}" class="bg-white shadow-lg rounded-2xl p-6 sm:p-8 space-y-5">

      {% if not current_user.is_authenticated %}
      <!-- âœ… ë¹„íšŒì› ì´ë©”ì¼ ì¸ì¦ -->
      <div>
        <label class="block text-sm font-semibold mb-1">{{ _("ì´ë©”ì¼") }}</label>
        <div class="flex space-x-2 mb-2">
          <input type="email" id="contact_email" name="email" value="{{ email or '' }}"
                class="w-full border border-gray-300 rounded-lg p-2.5 flex-1 focus:ring-2 focus:ring-[#007AFF]"
                placeholder="{{ _('ì´ë©”ì¼ ì…ë ¥') }}" required>
          <button type="button" id="send-email-btn" onclick="sendEmailCodeContact()"
                  class="bg-white border border-gray-400 text-[#222] px-3 py-2 rounded-lg hover:bg-gray-100 active:scale-[0.97] transition">
            {{ _("ì¸ì¦ë©”ì¼ ë³´ë‚´ê¸°") }}
          </button>
        </div>

        <div class="flex space-x-2 mb-1">
          <input type="text" id="verify_email_code" placeholder="{{ _('ì¸ì¦ì½”ë“œ ì…ë ¥') }}"
                class="border border-gray-300 p-2 rounded-lg flex-1 focus:ring-2 focus:ring-green-300 focus:border-green-400 transition">
          <button type="button" onclick="verifyEmailCodeContact()"
                  class="bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 active:scale-[0.97] transition">
            {{ _("ì¸ì¦ í™•ì¸") }}
          </button>
        </div>
        <p id="email-status" class="text-xs text-gray-500 mt-1"></p>
      </div>

      <div>
        <label class="block text-sm font-semibold mb-1">{{ _("ì´ë¦„") }}</label>
        <input type="text" name="guest_name" value="{{ guest_name or '' }}" class="w-full border border-gray-300 rounded-lg p-2.5">
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1">{{ _("ì „í™”ë²ˆí˜¸") }}</label>
        <input type="text" name="guest_phone" value="{{ guest_phone or '' }}" class="w-full border border-gray-300 rounded-lg p-2.5">
      </div>
      {% endif %}

      <div>
        <label class="block text-sm font-semibold mb-1">{{ _("ì œëª©") }}</label>
        <input type="text" name="title" value="{{ title or '' }}" class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-[#007AFF]" required>
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1">{{ _("ë‚´ìš©") }}</label>
        <textarea name="content" rows="5" class="w-full border border-gray-300 rounded-lg p-2.5 focus:ring-2 focus:ring-[#007AFF]" required>{{ content or '' }}</textarea>
      </div>
      <button type="submit" class="w-full btn-dark px-8 py-2.5 text-white rounded-full text-sm sm:text-base font-semibold shadow hover:opacity-90 transition">
        {{ _("ë³´ë‚´ê¸°") }}
      </button>
      <div class="g-recaptcha" 
          data-sitekey="6LfOVQAsAAAAAAGSTK6ge0BoGeT6OGpuQG7-jPf3"
          data-theme="light"
          style="transform:scale(0.95); transform-origin:0 0;">
      </div>
    </form>
  </div>
</section>

<script>
function sendEmailCodeContact() {
  const email = document.getElementById("contact_email").value.trim();
  const btn = document.getElementById("send-email-btn");
  const statusEl = document.getElementById("email-status");

  if (!email) return alert("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

  btn.disabled = true;
  btn.textContent = "ì „ì†¡ ì¤‘...";

  fetch("/send_email_code", {
    method: "POST",
    credentials: "include",
    body: new URLSearchParams({ email })
  })
  .then(res => res.json())
  .then(data => {
    alert(data.message);
    statusEl.textContent = "ì¸ì¦ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.";
    statusEl.className = "text-xs text-green-600 mt-1";
  })
  .catch(err => {
    console.error(err);
    alert("ì´ë©”ì¼ ì „ì†¡ ì˜¤ë¥˜");
  })
  .finally(() => {
    btn.disabled = false;
    btn.textContent = "ì¸ì¦ë©”ì¼ ë³´ë‚´ê¸°";
  });
}

function verifyEmailCodeContact() {
  const code = document.getElementById("verify_email_code").value.trim();
  const statusEl = document.getElementById("email-status");
  if (!code) return alert("ì¸ì¦ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

  fetch("/verify_email_code", {
    method: "POST",
    credentials: "include",
    body: new URLSearchParams({ code })
  })
  .then(res => res.json())
  .then(data => {
    alert(data.message);
    if (data.status === "ok") {
      statusEl.textContent = "ì´ë©”ì¼ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
      statusEl.className = "text-xs text-green-600 mt-1 font-semibold";
    } else {
      statusEl.textContent = "ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
      statusEl.className = "text-xs text-red-500 mt-1";
    }
  })
  .catch(err => {
    console.error(err);
    alert("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
  });
}
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const slides = document.querySelectorAll(".ad-slide");
  if (slides.length === 0) return;

  let idx = 0;
  slides[0].classList.add("opacity-100");

  setInterval(() => {
    slides[idx].classList.remove("opacity-100");
    idx = (idx + 1) % slides.length;
    slides[idx].classList.add("opacity-100");
  }, 4000);
});
</script>

<!-- reCAPTCHA -->
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
{% endblock %}