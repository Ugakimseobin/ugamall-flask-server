{% extends "base.html" %}
{% block content %}
<div class="max-w-3xl mx-auto bg-white p-4 sm:p-6 shadow rounded mt-6 sm:mt-8">
  <h1 class="text-xl sm:text-2xl font-bold mb-4 sm:mb-6">{{ product.name }} 옵션 조합 관리</h1>

  <!-- 옵션 조합 추가 폼 -->
  <form method="post" class="space-y-4">
    <h2 class="text-lg font-semibold">옵션 선택</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      {% set option_names = options | map(attribute="name") | unique | list %}
      {% for name in option_names %}
      <div>
        <label class="block font-semibold mb-1">{{ name }}</label>
        <select name="option_{{ name }}" class="w-full border rounded p-2 text-sm sm:text-base" required>
          <option value="">-- 선택하세요 --</option>
          {% for o in options if o.name == name %}
            <option value="{{ o.value }}">{{ o.value }}</option>
          {% endfor %}
        </select>
      </div>
      {% endfor %}
    </div>

    <div>
      <label class="block font-semibold mb-1">가격</label>
      <input type="number" step="1" name="price" 
             class="w-full border rounded p-2 text-sm sm:text-base" required>
    </div>

    <div>
      <label class="block font-semibold mb-1">재고</label>
      <input type="number" name="stock" 
             class="w-full border rounded p-2 text-sm sm:text-base" required>
    </div>

    <button type="submit" 
            class="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700 text-sm sm:text-base font-semibold">
      옵션 조합 추가
    </button>
  </form>
  
  <!-- ✅ 완료 버튼 -->
  <div class="mt-6 text-right">
    <a href="{{ url_for('admin_products') }}"
       class="inline-block bg-green-600 text-white px-4 sm:px-6 py-2 rounded hover:bg-green-700 text-sm sm:text-base">
       옵션 등록 완료
    </a>
  </div>

  <!-- 등록된 옵션 조합 리스트 -->
  <h2 class="text-lg sm:text-xl font-bold mt-8 mb-4">등록된 옵션 조합</h2>
  {% if variants %}
  <div class="overflow-x-auto">
    <table class="w-full border-collapse text-sm sm:text-base">
      <thead>
        <tr class="bg-gray-100 text-left">
          <th class="border px-3 py-2">ID</th>
          <th class="border px-3 py-2">SKU</th>
          <th class="border px-3 py-2">조합</th>
          <th class="border px-3 py-2">가격</th>
          <th class="border px-3 py-2">재고</th>
          <th class="border px-3 py-2">관리</th>
        </tr>
      </thead>
      <tbody>
        {% for v in variants %}
        <tr class="hover:bg-gray-50">
          <td class="border px-3 py-2">{{ v.id }}</td>
          <td class="border px-3 py-2">{{ v.sku }}</td>
          <td class="border px-3 py-2">
            {% for key, val in v.options.items() %}
              <span class="inline-block bg-gray-200 px-2 py-1 rounded mr-1 text-xs sm:text-sm">
                {{ key }}: {{ val }}
              </span>
            {% endfor %}
          </td>
          <td class="border px-3 py-2">{{ v.price }}</td>
          <td class="border px-3 py-2">{{ v.stock }}</td>
          <td class="border px-3 py-2 text-center">
            <form action="{{ url_for('admin_delete_variant', product_id=product.id, variant_id=v.id) }}" method="post">
              <button type="submit" class="text-red-600 hover:underline text-sm">삭제</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p class="text-gray-500 text-sm">등록된 옵션 조합이 없습니다.</p>
  {% endif %}
</div>
{% endblock %}
